<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>constructors/request.js - Application Prototype - Framework</title>
    
    <meta name="description" content="Application Prototype Framework based on Module Pattern" />
    
        <meta name="keywords" content="javascript, js, application-prototype, prototype" />
        <meta name="keyword" content="javascript, js, application-prototype, prototype" />
    
    
    
    <meta property="og:title" content="Application Prototype - Framework"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content=""/>
    
    <meta property="og:url" content="https://labs.sgapps.io/open-source/application-prototype"/>
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav class="wrap">
    
    <input type="text" id="nav-search" placeholder="Search" />
    
    <h2><a href="index.html">Home</a></h2><h2><a href="https://labs.sgapps.io/open-source/application-prototype" target="_blank" class="menu-item" id="website_link" >Project Page ( Git Lab )</a></h2><h2><a href="http://gordienco.net/" target="_blank" class="menu-item" id="website_link" >About Me</a></h2><h2><a href="https://github.com/sergiu-gordienco/application-prototype" target="_blank" class="menu-item" id="github_link" >GitHub</a></h2><h3>Modules</h3><ul><li><a href="module-ApplicationPrototype.html">ApplicationPrototype</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-ApplicationPrototype.html#~modulePath">modulePath</a></li></ul></li><li><a href="module-async.html">async</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-async.html#.flow">flow</a></li><li data-type='method' style='display: none;'><a href="module-async.html#.flow%25C2%25B7map">flow·map</a></li><li data-type='method' style='display: none;'><a href="module-async.html#.map">map</a></li><li data-type='method' style='display: none;'><a href="module-async.html#.waterfall">waterfall</a></li><li data-type='method' style='display: none;'><a href="module-async.html#.waterfall%25C2%25B7map">waterfall·map</a></li></ul></li><li><a href="module-extensions_prototype.html">extensions/prototype</a><ul class='members'><li data-type='member' style='display: none;'><a href="module-extensions_prototype.html#._">_</a></li><li data-type='member' style='display: none;'><a href="module-extensions_prototype.html#.__">__</a></li><li data-type='member' style='display: none;'><a href="module-extensions_prototype.html#.fn">fn</a></li><li data-type='member' style='display: none;'><a href="module-extensions_prototype.html#.object">object</a></li><li data-type='member' style='display: none;'><a href="module-extensions_prototype.html#.slDOM">slDOM</a></li><li data-type='member' style='display: none;'><a href="module-extensions_prototype.html#.slDOM_env">slDOM_env</a></li><li data-type='member' style='display: none;'><a href="module-extensions_prototype.html#.string">string</a></li><li data-type='member' style='display: none;'><a href="module-extensions_prototype.html#.WindowExtend">WindowExtend</a></li></ul></li><li><a href="module-js-template.html">js-template</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-js-template.html#~attrParser">attrParser</a></li><li data-type='method' style='display: none;'><a href="module-js-template.html#~expressionBuilder">expressionBuilder</a></li><li data-type='method' style='display: none;'><a href="module-js-template.html#~nodeParser">nodeParser</a></li><li data-type='method' style='display: none;'><a href="module-js-template.html#~parseTextNodes">parseTextNodes</a></li></ul></li><li><a href="module-request.html">request</a></li><li><a href="module-uri-load.html">uri-load</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-uri-load.html#.link">link</a></li><li data-type='method' style='display: none;'><a href="module-uri-load.html#.script">script</a></li></ul></li></ul><h3>Classes</h3><ul><li><a href="module-ApplicationPrototype.Builder.html">Builder</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-ApplicationPrototype.Builder.html#.consoleOptions">consoleOptions</a></li><li data-type='method' style='display: none;'><a href="module-ApplicationPrototype.Builder.html#.debugEnabled">debugEnabled</a></li><li data-type='method' style='display: none;'><a href="module-ApplicationPrototype.Builder.html#.isBrowser">isBrowser</a></li><li data-type='method' style='display: none;'><a href="module-ApplicationPrototype.Builder.html#.isNode">isNode</a></li><li data-type='method' style='display: none;'><a href="module-ApplicationPrototype.Builder.html#.moduleRegister">moduleRegister</a></li><li data-type='method' style='display: none;'><a href="module-ApplicationPrototype.Builder.html#.require">require</a></li><li data-type='method' style='display: none;'><a href="module-ApplicationPrototype.Builder.html#.runModulesInFiles">runModulesInFiles</a></li></ul></li><li class="level-hide"><a href="module-ApplicationPrototype.Builder.Promise.html">Promise</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-ApplicationPrototype.Builder.Promise.html#.all">all</a></li><li data-type='method' style='display: none;'><a href="module-ApplicationPrototype.Builder.Promise.html#.race">race</a></li><li data-type='method' style='display: none;'><a href="module-ApplicationPrototype.Builder.Promise.html#.reject">reject</a></li><li data-type='method' style='display: none;'><a href="module-ApplicationPrototype.Builder.Promise.html#.resolve">resolve</a></li></ul></li><li><a href="module-ApplicationPrototype.Instance.html">Instance</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-ApplicationPrototype.Instance.html#.bind">bind</a></li><li data-type='method' style='display: none;'><a href="module-ApplicationPrototype.Instance.html#.crudEvents">crudEvents</a></li><li data-type='method' style='display: none;'><a href="module-ApplicationPrototype.Instance.html#.off">off</a></li><li data-type='method' style='display: none;'><a href="module-ApplicationPrototype.Instance.html#.on">on</a></li><li data-type='method' style='display: none;'><a href="module-ApplicationPrototype.Instance.html#.once">once</a></li><li data-type='method' style='display: none;'><a href="module-ApplicationPrototype.Instance.html#.property">property</a></li><li data-type='method' style='display: none;'><a href="module-ApplicationPrototype.Instance.html#.property">property</a></li></ul></li><li><a href="module-async.Async.html">Async</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-async.Async.html#done">done</a></li><li data-type='method' style='display: none;'><a href="module-async.Async.html#errors">errors</a></li><li data-type='method' style='display: none;'><a href="module-async.Async.html#flush">flush</a></li><li data-type='method' style='display: none;'><a href="module-async.Async.html#index">index</a></li><li data-type='method' style='display: none;'><a href="module-async.Async.html#processing">processing</a></li><li data-type='method' style='display: none;'><a href="module-async.Async.html#receive">receive</a></li><li data-type='method' style='display: none;'><a href="module-async.Async.html#reserve">reserve</a></li><li data-type='method' style='display: none;'><a href="module-async.Async.html#responses">responses</a></li><li data-type='method' style='display: none;'><a href="module-async.Async.html#run">run</a></li><li data-type='method' style='display: none;'><a href="module-async.Async.html#wait">wait</a></li></ul></li><li><a href="module-extensions_prototype.slDOMSet.html">slDOMSet</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-extensions_prototype.slDOMSet.html#.add">add</a></li><li data-type='method' style='display: none;'><a href="module-extensions_prototype.slDOMSet.html#.attr">attr</a></li><li data-type='method' style='display: none;'><a href="module-extensions_prototype.slDOMSet.html#.attr">attr</a></li><li data-type='method' style='display: none;'><a href="module-extensions_prototype.slDOMSet.html#.attr">attr</a></li><li data-type='method' style='display: none;'><a href="module-extensions_prototype.slDOMSet.html#.attr">attr</a></li><li data-type='method' style='display: none;'><a href="module-extensions_prototype.slDOMSet.html#.config">config</a></li><li data-type='method' style='display: none;'><a href="module-extensions_prototype.slDOMSet.html#.config">config</a></li><li data-type='method' style='display: none;'><a href="module-extensions_prototype.slDOMSet.html#.each">each</a></li><li data-type='method' style='display: none;'><a href="module-extensions_prototype.slDOMSet.html#.env">env</a></li><li data-type='method' style='display: none;'><a href="module-extensions_prototype.slDOMSet.html#.eq">eq</a></li><li data-type='method' style='display: none;'><a href="module-extensions_prototype.slDOMSet.html#.filter">filter</a></li><li data-type='method' style='display: none;'><a href="module-extensions_prototype.slDOMSet.html#.find">find</a></li><li data-type='method' style='display: none;'><a href="module-extensions_prototype.slDOMSet.html#.get">get</a></li><li data-type='method' style='display: none;'><a href="module-extensions_prototype.slDOMSet.html#.get">get</a></li><li data-type='method' style='display: none;'><a href="module-extensions_prototype.slDOMSet.html#.map">map</a></li><li data-type='method' style='display: none;'><a href="module-extensions_prototype.slDOMSet.html#.set">set</a></li><li data-type='method' style='display: none;'><a href="module-extensions_prototype.slDOMSet.html#.set">set</a></li><li data-type='method' style='display: none;'><a href="module-extensions_prototype.slDOMSet.html#.unique">unique</a></li></ul></li><li><a href="module-request.RequestModule.html">RequestModule</a><ul class='members'><li data-type='member' style='display: none;'><a href="module-request.RequestModule.html#.READY_STATE_DONE">READY_STATE_DONE</a></li><li data-type='member' style='display: none;'><a href="module-request.RequestModule.html#.READY_STATE_HEADERS_RECEIVED">READY_STATE_HEADERS_RECEIVED</a></li><li data-type='member' style='display: none;'><a href="module-request.RequestModule.html#.READY_STATE_LOADING">READY_STATE_LOADING</a></li><li data-type='member' style='display: none;'><a href="module-request.RequestModule.html#.READY_STATE_OPENED">READY_STATE_OPENED</a></li><li data-type='member' style='display: none;'><a href="module-request.RequestModule.html#.READY_STATE_UNSENT">READY_STATE_UNSENT</a></li></ul><ul class='methods'><li data-type='method' style='display: none;'><a href="module-request.RequestModule.html#async">async</a></li><li data-type='method' style='display: none;'><a href="module-request.RequestModule.html#async">async</a></li><li data-type='method' style='display: none;'><a href="module-request.RequestModule.html#config">config</a></li><li data-type='method' style='display: none;'><a href="module-request.RequestModule.html#configurator">configurator</a></li><li data-type='method' style='display: none;'><a href="module-request.RequestModule.html#headers">headers</a></li><li data-type='method' style='display: none;'><a href="module-request.RequestModule.html#headers">headers</a></li><li data-type='method' style='display: none;'><a href="module-request.RequestModule.html#method">method</a></li><li data-type='method' style='display: none;'><a href="module-request.RequestModule.html#method">method</a></li><li data-type='method' style='display: none;'><a href="module-request.RequestModule.html#open">open</a></li><li data-type='method' style='display: none;'><a href="module-request.RequestModule.html#readyState">readyState</a></li><li data-type='method' style='display: none;'><a href="module-request.RequestModule.html#request">request</a></li><li data-type='method' style='display: none;'><a href="module-request.RequestModule.html#response">response</a></li><li data-type='method' style='display: none;'><a href="module-request.RequestModule.html#response">response</a></li><li data-type='method' style='display: none;'><a href="module-request.RequestModule.html#response">response</a></li><li data-type='method' style='display: none;'><a href="module-request.RequestModule.html#response">response</a></li><li data-type='method' style='display: none;'><a href="module-request.RequestModule.html#response">response</a></li><li data-type='method' style='display: none;'><a href="module-request.RequestModule.html#response">response</a></li><li data-type='method' style='display: none;'><a href="module-request.RequestModule.html#send">send</a></li><li data-type='method' style='display: none;'><a href="module-request.RequestModule.html#status">status</a></li><li data-type='method' style='display: none;'><a href="module-request.RequestModule.html#statusText">statusText</a></li><li data-type='method' style='display: none;'><a href="module-request.RequestModule.html#timeout">timeout</a></li><li data-type='method' style='display: none;'><a href="module-request.RequestModule.html#timeout">timeout</a></li><li data-type='method' style='display: none;'><a href="module-request.RequestModule.html#url">url</a></li><li data-type='method' style='display: none;'><a href="module-request.RequestModule.html#url">url</a></li><li data-type='method' style='display: none;'><a href="module-request.RequestModule.html#withCredentials">withCredentials</a></li><li data-type='method' style='display: none;'><a href="module-request.RequestModule.html#withCredentials">withCredentials</a></li></ul></li></ul><h3>Events</h3><ul><li class="level-hide"><a href="module-ApplicationPrototype.Instance.html#.event:__afterGet">__afterGet</a></li><li class="level-hide"><a href="module-ApplicationPrototype.Instance.html#.event:__afterGet::propName">__afterGet::propName</a></li><li class="level-hide"><a href="module-ApplicationPrototype.Instance.html#.event:__afterSet">__afterSet</a></li><li class="level-hide"><a href="module-ApplicationPrototype.Instance.html#.event:__afterSet::propName">__afterSet::propName</a></li><li class="level-hide"><a href="module-ApplicationPrototype.Instance.html#.event:__onGet">__onGet</a></li><li class="level-hide"><a href="module-ApplicationPrototype.Instance.html#.event:__onGet::propName">__onGet::propName</a></li><li class="level-hide"><a href="module-ApplicationPrototype.Instance.html#.event:__onSet">__onSet</a></li><li class="level-hide"><a href="module-ApplicationPrototype.Instance.html#.event:__onSet::propName">__onSet::propName</a></li></ul><h3>Global</h3><ul><li><a href="global.html#browserSessionBuilder">browserSessionBuilder</a></li><li><a href="global.html#BrowserSessionModule">BrowserSessionModule</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">constructors/request.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/* jshint -W002 */

/**
 * @memberof module:request
 * @class
 * @name RequestModule 
 */

/**
 * @memberof module:request
 * @callback RequestModuleConstructor
 * @returns {RequestModule}
 */

/**
 * Module used for retrieving date using XMLHttpRequest
 * @example
 * Application.require('request').then(function (request) {
 *	 request()
 *		 .url('/data.json')
 *		 .response('json')
 *		 .then(function (data) {
 *			 console.log(data);
 *		 }, console.error);
 * }, console.error);
 * @module request
 * @returns {RequestModuleConstructor}
 * @see module:request.RequestModule
 */

Application.require("extensions/prototype", function (epro) {

	function Request() {
		var app	 = new ApplicationPrototype();
		var httpRequest = new XMLHttpRequest();


		/**
		 * @typedef {Object} module:request.RequestModule.RequestConfig
		 * @inner
		 * @property {boolean} [method="GET"]
		 * @property {boolean} [url="#"]
		 * @property {boolean} [async=true]
		 * @property {boolean} [opened=false]
		 * @property {boolean} [isSent=false]
		 * @property {boolean} [isLoaded=false]
		 * @property {boolean} [isUploaded=false]
		 * @property {boolean} [ignoreStatusCode=false]
		 */
		var config  = {
			method  : "GET",
			url	 : "#",
			async   : true,
			opened  : false,
			isSent  : false,
			isLoaded: false,
			isUploaded: false,
			ignoreStatusCode : false
		};


		/**
		 * @typedef {object} module:request.RequestModule.readyStateType
		 * @property {number} [READY_STATE_UNSENT=0]
		 * @property {number} [READY_STATE_OPENED=1]
		 * @property {number} [READY_STATE_HEADERS_RECEIVED=2]
		 * @property {number} [READY_STATE_LOADING=3]
		 * @property {number} [READY_STATE_DONE=4]
		 */

		var configurator	= {
			"ignore-status-code"  : function () {
			  config.ignoreStatusCode = true;
			},
			"check-status-code"  : function () {
			  config.ignoreStatusCode = false;
			},
			"prepare-post"  : function () {
				httpRequest.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
			},
			"retrieve-binary-string"	: function () {
				httpRequest.overrideMimeType("text/plain; charset=x-user-defined");
				httpRequest.responseType = "arraybuffer";
			},
			"retrieve-blob"	: function () {
				httpRequest.responseType = "blob";
			},
			"prepare-multipart" : function () {
				config.sBoundary	= config.sBoundary || epro.fn.getRandId().toHex();
				httpRequest.setRequestHeader("Content-Type", "multipart\/form-data; boundary=" + config.sBoundary);
			},
			"POST" : "prepare-post",
			"binary"	: "retrieve-binary-string",
			"blob" : "retrieve-blob",
			"multipart" : "prepare-multipart"
		};

		/**
		 * @method config
		 * @memberof module:request.RequestModule#
		 * @returns {RequestModule.RequestConfig}
		 */
		app.bind("config", function () {
			return config;
		});

		/**
		 * @method configurator
		 * @memberof module:request.RequestModule#
		 * @param {('multipart'|'blob'|'binary'|'POST'|'prepare-multipart'|'retrieve-blob'|'retrieve-binary-string'|'prepare-post'|'check-status-code'|'ignore-status-code')} template configuration name
		 * @returns {RequestModule}
		 */
		app.bind("configurator", function (template) {
			var f = function (template) {
				if (typeof(configurator[template]) === "string") {
					return f(configurator[template]);
				} else if (typeof(configurator[template]) === "function") {
					return configurator[template];
				}
			};
			var configTemplate = f(template);
			if (typeof(configTemplate) === "function") {
				configTemplate();
			}
			return app;
		});

		// events for download
		httpRequest.addEventListener("progress", function (evt) {
			if (evt.lengthComputable &amp;&amp; evt.total) {
				var percentComplete = evt.loaded / evt.total;
				app.emit("progress", [evt, percentComplete]);
			} else {
				app.emit("progress", [evt]);
			}
		});
		httpRequest.addEventListener("load", function (evt) {
			app.emit("load", [evt]);
		});
		httpRequest.addEventListener("loadend", function (evt) {
			config.isLoaded = true;
			app.emit("loadend", [evt]);
		});
		httpRequest.addEventListener("error", function (evt) {
			app.emit("error", [evt]);
		});
		httpRequest.addEventListener("abort", function (evt) {
			app.emit("abort", [evt]);
		});

		// events for upload
		httpRequest.upload.addEventListener("progress", function (evt) {
			if (evt.lengthComputable &amp;&amp; evt.total) {
				var percentComplete = evt.loaded / evt.total;
				app.emit("upload-progress", [evt, percentComplete]);
			} else {
				app.emit("upload-progress", [evt]);
			}
		});
		httpRequest.upload.addEventListener("load", function (evt) {
			app.emit("upload-load", [evt]);
		});
		httpRequest.upload.addEventListener("error", function (evt) {
			app.emit("upload-error", [evt]);
		});
		httpRequest.upload.addEventListener("abort", function (evt) {
			app.emit("upload-abort", [evt]);
		});


		httpRequest.upload.addEventListener("loadend", function (evt) {
			config.isUploaded = true;
			app.emit("upload-loadend", [evt]);
		});

		/**
		 * @method request
		 * @memberof module:request.RequestModule#
		 * @returns {XMLHttpRequest}
		 */
		app.bind("request", function () { return httpRequest; }, "");

		/**
		 * @method response
		 * @memberof module:request.RequestModule#
		 * @returns {XMLHttpRequest.response}
		 */


		/**
		 * @method response
		 * @memberof module:request.RequestModule#
		 * @param {'request'} type
		 * @returns {Promise&lt;RequestModule>}
		 */

		/**
		 * @method response
		 * @memberof module:request.RequestModule#
		 * @param {'blob'} type
		 * @param {{ type: string }} [params={type: 'application/octet-stream'}] Blob constructor's params
		 * @returns {Promise&lt;Blob>}
		 */

		/**
		 * @method response
		 * @memberof module:request.RequestModule#
		 * @param {'arraybuffer'} type
		 * @returns {Promise&lt;ArrayBuffer>}
		 */

		/**
		 * @method response
		 * @memberof module:request.RequestModule#
		 * @param {('text'|'json')} type
		 * @returns {Promise&lt;string>}
		 */

		/**
		 * @method response
		 * @memberof module:request.RequestModule#
		 * @param {'document'} type
		 * @returns {HTMLElement}
		 */
		app.bind("response", function (type, params) {
			var er, err, data, node;
			if (typeof(type) === "undefined") {
				return httpRequest.response;
			} else {
				if (!config.isSent) {
					app.send();
				}
				if (!config.isLoaded) {
					return new Application.Promise(function (resolve, reject) {
						app.on("loadend", function () {
							var result = app.response(type, params);
							result.then(function (data) {
								resolve(data);
							}, function (er) {
								er.httpRequest = app;
								reject(er);
							});
						});
						app.on("error", function (er) {
							er.httpRequest = app;
							reject(er);
						});
					});
				}
				var response = Application.Promise(), reader;
				if (type === "request") {
				  response.resolve(app);
				} else if (type === "response") {
				  response.resolve(httpRequest.response);
				} else if (httpRequest.responseType === "arraybuffer") {
					switch (type) {
						case "blob":
							response.resolve(new Blob(
								[httpRequest.response],
								params || {type: "application/octet-stream"}
							));
						break;
						case "json":
							data	= undefined;
							er = undefined;
							try {
								data = JSON.parse(httpRequest.response.toStringUtf8());
								response.resolve(data);
							} catch (err) { er = err; }
							if (typeof(er) !== "undefined") {
								response.reject(er);
							}
						break;
						case "document":
							node = document.createElement("div");
							node.innerHTML  = httpRequest.response.toStringUtf8();
							response.resolve(node);
						break;
						case "text":
							response.resolve(httpRequest.response.toStringUtf8());
						break;
						case "arraybuffer":
							response.resolve(httpRequest.response);
						break;
					}
				} else if (httpRequest.responseType === "blob") {
					switch (type) {
						case "blob":
							response.resolve(httpRequest.response);
						break;
						case "json":
							httpRequest.response.toArrayBuffer(function (er, data) {
								if (typeof(er) !== "undefined") {
									response.reject(er);
								} else {
									var str = data.toStringUtf8();
									data = undefined;
									er  = undefined;
									try {
										data = JSON.parse(str);
										response.resolve(data);
									} catch (err) { er = err; }
									if (typeof(er) !== "undefined") {
										response.reject(er);
									}
								}
							});
						break;
						case "document":
							httpRequest.response.toArrayBuffer(function (er, data) {
								if (typeof(er) !== "undefined") {
									response.reject(er);
								} else {
									var node = document.createElement("div");
									node.innerHTML  = data.toStringUtf8();
									response.resolve(node);
								}
							});
						break;
						case "text":
							httpRequest.response.toArrayBuffer(function (er, data) {
								if (typeof(er) !== "undefined") {
									response.reject(er);
								} else {
									response.resolve(data.toStringUtf8());
								}
							});
						break;
						case "arraybuffer":
							httpRequest.response.toArrayBuffer(function (er, data) {
								if (typeof(er) !== "undefined") {
									response.reject(er);
								} else {
									response.resolve(data);
								}
							});
						break;
					}
				} else {
					switch (type) {
						case "blob":
							response.resolve(new Blob([httpRequest.response], (params || { type: "application/octet-stream" })));
						break;
						case "json":
							var str = httpRequest.response;
							data = undefined;
							er  = undefined;
							try {
								data = JSON.parse(str);
								response.resolve(data);
							} catch (err) { er = err; }
							if (typeof(er) !== "undefined") {
								response.reject(er);
							}
						break;
						case "document":
							node = document.createElement("div");
							node.innerHTML  = httpRequest.response;
							response.resolve(node);
						break;
						case "text":
							response.resolve(httpRequest.response);
						break;
						case "arraybuffer":
							response.resolve(httpRequest.response.toArrayBufferFromUtf8());
						break;
					}
				}
				return new Application.Promise(function (resolve, reject) {
				  response.then(function (data) {
					if (httpRequest.status === 200 || config.ignoreStatusCode) {
					  resolve(data);
					} else {
					  var er = Error(
						httpRequest.statusText ?
						('Status '+ httpRequest.status + ': ' + httpRequest.statusText) :
						("Response Status is " + httpRequest.status)
					  );
					  er.httpRequest = app;
					  er.httpResponse = data;
					  reject(er);
					}
				  }, function (er) {
					er.httpRequest = app;
					reject(er);
				  });
				});
			}
		}, "");

		/**
		 * current XMLHttpRequest timeout in seconds
		 * @method timeout
		 * @memberof module:request.RequestModule#
		 * @returns {number}
		 */

		/**
		 * update XMLHttpRequest timeout in seconds
		 * @method timeout
		 * @memberof module:request.RequestModule#
		 * @param {number} seconds set 0 to unlimited
		 * @returns {RequestModule}
		 */
		app.bind("timeout", function (seconds) {
		  if (typeof(seconds) === "number") {
			httpRequest.timeout = seconds || 0;
			return app;
		  }
		  return httpRequest.timeout || 0;
		});

		/**
		 * current XMLHttpRequest withCredentials status
		 * @method withCredentials
		 * @memberof module:request.RequestModule#
		 * @returns {boolean}
		 */
		
		/**
		 * update XMLHttpRequest withCredentials flag
		 * @method withCredentials
		 * @memberof module:request.RequestModule#
		 * @param {boolean} status
		 * @returns {RequestModule}
		 */
		app.bind("withCredentials", function (status) {
		  if (typeof(status) === "boolean") {
			httpRequest.withCredentials = !!status;
			return app;
		  }
		  return !!httpRequest.withCredentials;
		});

		/**
		 * Client has been created. open() not called yet.
		 * @alias module:request.RequestModule.READY_STATE_UNSENT
		 * @type {number}
		 * @default 0
		 */
		app.READY_STATE_UNSENT = 0;
		/**
		 * open() has been called.
		 * @alias module:request.RequestModule.READY_STATE_OPENED
		 * @type {number}
		 * @default 1
		 */
		app.READY_STATE_OPENED = 1;
		/**
		 * send() has been called, and headers and status are available.
		 * @alias module:request.RequestModule.READY_STATE_HEADERS_RECEIVED
		 * @type {number}
		 * @default 2
		 */
		app.READY_STATE_HEADERS_RECEIVED = 2;
		/**
		 * Downloading; responseText holds partial data.
		 * @alias module:request.RequestModule.READY_STATE_LOADING
		 * @type {number}
		 * @default 3
		 */
		app.READY_STATE_LOADING = 3;
		/**
		 * Downloading is done
		 * @alias module:request.RequestModule.READY_STATE_DONE
		 * @type {number}
		 * @default 4
		 */
		app.READY_STATE_DONE = 4;


		/**
		 * @method readyState
		 * @memberof module:request.RequestModule#
		 * @returns {RequestModule.readyStateType}
		 */
		app.bind("readyState", function (int) {
		  return httpRequest.readyState;
		});

		httpRequest.onreadystatechange = function () {
		  app.emit('onReadyState', [httpRequest.readyState, httpRequest.status]);
		};

		/**
		 * @method status
		 * @memberof module:request.RequestModule#
		 * @returns {XMLHttpRequest.status}
		 */
		app.bind("status", function (int) {
		  return httpRequest.status;
		});

		/**
		 * @method statusText
		 * @memberof module:request.RequestModule#
		 * @returns {XMLHttpRequest.statusText}
		 */
		app.bind("statusText", function (int) {
		  return httpRequest.statusText;
		});


		/**
		 * @method async
		 * @memberof module:request.RequestModule#
		 * @returns {RequestModule.RequestConfig.async}
		 * @see module:request.RequestModule.RequestConfig
		 */
		/**
		 * @method async
		 * @memberof module:request.RequestModule#
		 * @param {boolean} status enable/disable XMLHttpRequest async mode
		 * @returns {RequestModule}
		 */
		app.bind("async", function (bool) {
			if (typeof(bool) !== "undefined") {
				config.async = !!bool;
				return app;
			}
			return config.async;
		});

		/**
		 * @method method
		 * @memberof module:request.RequestModule#
		 * @returns {RequestModule.RequestConfig.method}
		 * @see module:request.RequestModule.RequestConfig
		 */
		/**
		 * @method method
		 * @memberof module:request.RequestModule#
		 * @param {string} status XMLHttpRequest method name, default is `"GET"`
		 * @returns {RequestModule}
		 */
		app.bind("method", function (method) {
			if (typeof(method) === "string") {
				config.method = method;
				return app;
			}
			return config.method;
		});

		/**
		 * @method url
		 * @memberof module:request.RequestModule#
		 * @returns {RequestModule.RequestConfig.url}
		 * @see module:request.RequestModule.RequestConfig
		 *//**
		 * @memberof module:request.RequestModule#
		 * @method url
		 * @param {string} url setup the url that should be processed
		 * @returns {RequestModule}
		 */
		app.bind("url", function (url) {
			if (typeof(url) === "string") {
				config.url = url;
				return app;
			}
			return config.url;
		});

		/**
		 * @method open
		 * @memberof module:request.RequestModule#
		 * @param {string} [method="GET"]
		 * @param {string} [url]
		 * @param {boolean} [async]
		 * @param {number} [timeout] request timeout in seconds
		 * @returns {RequestModule}
		 */
		app.bind("open", function (method, url, async, timeout) {
			if (method &amp;&amp; typeof(url) === "undefined" &amp;&amp; typeof(async) === "undefined") {
				url = method;
				method = undefined;
			}
			app.timeout(timeout);
			config.opened   = true;
			httpRequest.open(method || config.method, url || config.url, async || config.async);
			return app;
		});

		/**
		 * @method send
		 * @memberof module:request.RequestModule#
		 * @param {string|FormData|MediaStream} [data='']
		 * @param {("asFormData"|"json")} [type=null]
		 * @returns {RequestModule}
		 */
		app.bind("send", function (data, type) {
			if (!config.opened) {
				app.open();
			}
			if (config.isSent) {
				console.warn("Error: the request is sended twice", app, app.request());
				return app;
			}
			config.isSent   = true;
			if (type === "asFormData") {
				// convert data to form data
				var fData = new FormData();
				var i;
				for (i in data) {
					fData.append(i, data[i]);
				}
				httpRequest.send(fData);
			} else if (type === "json") {
				httpRequest.send(JSON.stringify(data));
			} else {
				httpRequest.send(typeof(data) === "undefined" ? null : data);
			}
			return app;
		});

		/**
		 * @method headers
		 * @memberof module:request.RequestModule#
		 * @returns {string}
		 */
		app.bind("headers", function () {
		  return httpRequest.getAllResponseHeaders();
		});

		/**
		 * set a new header
		 * @method headers
		 * @memberof module:request.RequestModule#
		 * @param {string} name
		 * @param {string} value
		 * @returns {RequestModule}
		 */
		app.bind("header", function (name, value) {
			httpRequest.setRequestHeader(name, value);
			return app;
		});

		return app;
	};
	module.exports  = Request;
});</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.3</a> using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>

<script src="scripts/search.js" defer></script>


<script src="scripts/collapse.js" defer></script>


</body>
</html>
